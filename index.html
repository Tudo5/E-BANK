<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-BANK 2.0 ULTRA • Неоновый Кибер-Банкинг</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #0088ff;
            --accent: #ff0088;
            --warning: #ffaa00;
            --danger: #ff5555;
            --success: #00ff88;
            --dark: #0a0a1a;
            --darker: #050510;
            --light: #f0f0f0;
            --glass: rgba(20, 20, 40, 0.7);
            --grid-color: rgba(0, 136, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Exo 2', 'Segoe UI', sans-serif;
        }

        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                linear-gradient(45deg, var(--grid-color) 1px, transparent 1px),
                linear-gradient(-45deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* ====== УВЕДОМЛЕНИЯ ====== */
        .notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
            width: 100%;
        }

        .notification {
            background: rgba(20, 20, 40, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 15px 20px;
            color: white;
            font-weight: 500;
            transform: translateX(120%) scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .notification.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .notification.hiding {
            transform: translateX(120%) scale(0.9);
            opacity: 0;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    rgba(0, 255, 136, 0.1) 0%,
                    rgba(0, 136, 255, 0.05) 100%);
            z-index: -1;
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 5px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .notification-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .notification-success {
            border-left-color: var(--success);
            background: rgba(20, 40, 20, 0.95);
        }

        .notification-success .notification-icon {
            color: var(--success);
        }

        .notification-error {
            border-left-color: var(--danger);
            background: rgba(40, 20, 20, 0.95);
        }

        .notification-error .notification-icon {
            color: var(--danger);
        }

        .notification-warning {
            border-left-color: var(--warning);
            background: rgba(40, 30, 10, 0.95);
        }

        .notification-warning .notification-icon {
            color: var(--warning);
        }

        .notification-info {
            border-left-color: var(--secondary);
            background: rgba(10, 20, 40, 0.95);
        }

        .notification-info .notification-icon {
            color: var(--secondary);
        }

        .notification-special {
            border-left-color: var(--accent);
            background: rgba(40, 10, 40, 0.95);
            animation: neonPulse 2s infinite;
        }

        .notification-special .notification-icon {
            color: var(--accent);
        }

        @keyframes neonPulse {

            0%,
            100% {
                box-shadow: 0 0 5px rgba(255, 0, 136, 0.5);
            }

            50% {
                box-shadow: 0 0 20px rgba(255, 0, 136, 0.8);
            }
        }

        /* Анимация клика */
        .click-effect {
            position: fixed;
            pointer-events: none;
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(0, 200, 255, 0.7);
            animation: floatUp 1s ease forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.2);
            }
        }

        /* Контейнеры */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Экран авторизации */
        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 136, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 0, 136, 0.15) 0%, transparent 50%);
            z-index: -1;
        }

        .auth-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 50px;
            width: 100%;
            max-width: 600px;
            box-shadow:
                0 0 50px rgba(0, 255, 136, 0.3),
                0 0 100px rgba(0, 136, 255, 0.2),
                inset 0 0 50px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(5deg);
            transition: transform 0.5s ease;
            background: linear-gradient(135deg,
                    rgba(0, 255, 136, 0.1) 0%,
                    rgba(0, 136, 255, 0.1) 25%,
                    rgba(255, 0, 136, 0.1) 50%,
                    rgba(0, 136, 255, 0.1) 75%,
                    rgba(0, 255, 136, 0.1) 100%);
        }

        .auth-card:hover {
            transform: perspective(1000px) rotateX(0deg);
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent), var(--primary));
            border-radius: 27px;
            z-index: -1;
            filter: blur(10px);
            opacity: 0.5;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .auth-title {
            font-size: 3.5rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            0% {
                text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            }

            100% {
                text-shadow: 0 0 30px rgba(0, 255, 136, 0.8), 0 0 40px rgba(0, 136, 255, 0.6);
            }
        }

        .auth-subtitle {
            color: #aaa;
            font-size: 1.2rem;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }

        /* Табы */
        .tabs {
            display: flex;
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            color: #777;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            color: var(--light);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 136, 255, 0.2));
            color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        /* Формы */
        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: formAppear 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes formAppear {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        .form-label {
            display: block;
            color: var(--primary);
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            padding-left: 20px;
        }

        .form-label::before {
            content: '▶';
            position: absolute;
            left: 0;
            color: var(--secondary);
            animation: arrowBlink 1.5s infinite;
        }

        @keyframes arrowBlink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .form-input {
            width: 100%;
            padding: 18px 25px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--light);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            font-family: 'Exo 2', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow:
                0 0 25px rgba(0, 255, 136, 0.4),
                inset 0 0 15px rgba(0, 255, 136, 0.1);
            background: rgba(0, 0, 0, 0.6);
            transform: translateY(-2px);
        }

        /* КНОПКИ */
        .btn {
            padding: 18px 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 6px 20px rgba(0, 255, 136, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            min-height: 56px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow:
                0 12px 30px rgba(0, 255, 136, 0.6),
                0 0 30px rgba(0, 136, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(-2px) scale(1.01);
            box-shadow:
                0 4px 15px rgba(0, 255, 136, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn i {
            font-size: 1.3rem;
            transition: transform 0.3s ease;
        }

        .btn:hover i {
            transform: translateX(3px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff3366, #ff0033);
            box-shadow:
                0 6px 20px rgba(255, 51, 102, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-danger:hover {
            box-shadow:
                0 12px 30px rgba(255, 51, 102, 0.6),
                0 0 30px rgba(255, 0, 51, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffaa00, #ff7700);
            box-shadow:
                0 6px 20px rgba(255, 170, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-warning:hover {
            box-shadow:
                0 12px 30px rgba(255, 170, 0, 0.6),
                0 0 30px rgba(255, 119, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #00cc66, #00994d);
            box-shadow:
                0 6px 20px rgba(0, 204, 102, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-success:hover {
            box-shadow:
                0 12px 30px rgba(0, 204, 102, 0.6),
                0 0 30px rgba(0, 153, 77, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #3366ff, #0033cc);
            box-shadow:
                0 6px 20px rgba(51, 102, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-info:hover {
            box-shadow:
                0 12px 30px rgba(51, 102, 255, 0.6),
                0 0 30px rgba(0, 51, 204, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-sm {
            padding: 12px 24px;
            font-size: 0.95rem;
            min-height: 44px;
            letter-spacing: 1px;
        }

        .btn-lg {
            padding: 22px 40px;
            font-size: 1.3rem;
            min-height: 64px;
            letter-spacing: 3px;
        }

        /* Основной интерфейс */
        #mainApp {
            display: none;
            opacity: 0;
            animation: fadeIn 1s 0.3s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Шапка */
        .header {
            background: rgba(10, 10, 25, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .logo {
            font-size: 2.5rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
            padding-right: 20px;
        }

        /* Навигационные табы */
        .nav-tabs {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            border-color: rgba(0, 255, 136, 0.3);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.2);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border-color: transparent;
            box-shadow:
                0 0 20px rgba(0, 255, 136, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Кнопка выхода */
        .logout-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff3366, #cc0033);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow:
                0 6px 20px rgba(255, 51, 102, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow:
                0 12px 30px rgba(255, 51, 102, 0.6),
                0 0 30px rgba(204, 0, 51, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Статистика */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.9), rgba(40, 40, 60, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: floatCard 20s infinite ease-in-out;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow:
                0 15px 40px rgba(0, 255, 136, 0.3),
                0 0 30px rgba(0, 136, 255, 0.2);
        }

        .stat-title {
            color: #aaa;
            font-size: 0.95rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.8rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        /* Секции */
        .section {
            display: none;
            padding: 40px 0;
            animation: sectionSlide 0.5s ease;
        }

        @keyframes sectionSlide {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2.5rem;
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 20px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            position: relative;
            padding-bottom: 20px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }

        /* Функциональные карточки */
        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .function-card {
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: floatCard 25s infinite ease-in-out;
        }

        .function-card:hover {
            border-color: var(--primary);
            transform: translateY(-8px);
            box-shadow:
                0 20px 50px rgba(0, 255, 136, 0.3),
                0 0 40px rgba(0, 136, 255, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        .function-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .function-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--dark);
            box-shadow:
                0 0 20px rgba(0, 255, 136, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .function-card:hover .function-icon {
            transform: scale(1.1);
        }

        .function-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .function-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--light);
            flex-grow: 1;
        }

        /* Таблицы */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 30px;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(30, 30, 50, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 136, 255, 0.2));
            padding: 20px;
            text-align: left;
            color: var(--primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--primary);
            font-family: 'Orbitron', sans-serif;
        }

        .data-table td {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
            transition: all 0.2s;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(3px);
        }

        /* Кликер */
        .clicker-container {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg,
                    rgba(0, 255, 136, 0.15),
                    rgba(0, 136, 255, 0.15));
            border-radius: 30px;
            border: 2px solid var(--primary);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 0 60px rgba(0, 255, 136, 0.3),
                inset 0 0 40px rgba(255, 255, 255, 0.05);
        }

        .click-button {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: var(--dark);
            font-size: 1.8rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 0 80px rgba(0, 255, 136, 0.6),
                0 0 0 10px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 3px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .click-button:hover {
            transform: scale(1.05);
            box-shadow:
                0 0 100px rgba(0, 255, 136, 0.8),
                0 0 0 15px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .click-button:active {
            transform: scale(0.95);
            box-shadow:
                0 0 60px rgba(0, 255, 136, 0.6),
                0 0 0 5px rgba(255, 255, 255, 0.1),
                inset 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .click-button i {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .clicker-stats {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .clicker-stat {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .clicker-stat:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.2);
        }

        .clicker-stat-label {
            color: #aaa;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .clicker-stat-value {
            color: var(--primary);
            font-size: 2.2rem;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        /* Частицы */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }

        /* Админ-панель */
        #adminTab {
            background: linear-gradient(135deg, var(--accent), #ff5500);
            color: white;
            border-color: transparent;
        }

        #adminTab:hover {
            background: linear-gradient(135deg, #ff0088, #ff6600);
            transform: translateY(-3px);
        }

        /* Анимация загрузки */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .loading::after {
            content: '';
            width: 40px;
            height: 40px;
            border: 3px solid var(--primary);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes purchaseGlow {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(0, 255, 136, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 255, 136, 0);
            }
        }

        /* Анимация плавающих карточек */
        @keyframes floatCard {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-10px) rotate(0.5deg);
            }

            50% {
                transform: translateY(5px) rotate(-0.3deg);
            }

            75% {
                transform: translateY(-5px) rotate(0.2deg);
            }
        }

        .stat-card:nth-child(1) {
            animation-delay: 0s;
        }

        .stat-card:nth-child(2) {
            animation-delay: 2s;
        }

        .stat-card:nth-child(3) {
            animation-delay: 4s;
        }

        .stat-card:nth-child(4) {
            animation-delay: 6s;
        }

        .stat-card:nth-child(5) {
            animation-delay: 8s;
        }

        .stat-card:nth-child(6) {
            animation-delay: 10s;
        }

        .function-card:nth-child(odd) {
            animation-delay: 0s;
        }

        .function-card:nth-child(even) {
            animation-delay: 5s;
        }

        /* Медиа-запросы */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .function-grid {
                grid-template-columns: 1fr;
            }

            .clicker-stats {
                flex-direction: column;
                gap: 15px;
            }

            .clicker-stat {
                min-width: 100%;
            }

            .notification-container {
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .auth-card {
                padding: 30px;
            }

            .auth-title {
                font-size: 2.5rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .stat-value {
                font-size: 2.2rem;
            }

            .click-button {
                width: 200px;
                height: 200px;
                font-size: 1.5rem;
            }
        }

        /* Стили для админ вкладок */
        .admin-tab {
            display: none;
            animation: sectionSlide 0.5s ease;
        }

        .admin-tab.active {
            display: block;
        }

        .users-table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-container input {
            flex: 1;
            min-width: 200px;
        }
    </style>
</head>

<body>
    <!-- Контейнер для уведомлений -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Экран авторизации -->
    <div id="authApp" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1 class="auth-title">E-BANK 2.0 ULTRA</h1>
                <p class="auth-subtitle">Неоновый кибер-банкинг нового поколения</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showAuthTab('login')">
                    <i class="fas fa-sign-in-alt"></i> Вход
                </button>
                <button class="tab" onclick="showAuthTab('register')">
                    <i class="fas fa-user-plus"></i> Регистрация
                </button>
            </div>

            <form id="loginForm" class="auth-form active" onsubmit="login(event)">
                <div class="form-group">
                    <label class="form-label">Логин</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Введите ваш логин" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Введите ваш пароль"
                        required>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-terminal"></i> Войти в систему
                </button>
            </form>

            <form id="registerForm" class="auth-form" onsubmit="register(event)">
                <div class="form-group">
                    <label class="form-label">Логин</label>
                    <input type="text" class="form-input" id="registerUsername"
                        placeholder="Придумайте уникальный логин" required minlength="3">
                </div>
                <div class="form-group">
                    <label class="form-label">Ваше имя</label>
                    <input type="text" class="form-input" id="registerName" placeholder="Как к вам обращаться?"
                        required>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="Минимум 6 символов"
                        required minlength="6">
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-user-astronaut"></i> Создать аккаунт
                </button>
            </form>
        </div>
    </div>

    <!-- Основной интерфейс -->
    <div id="mainApp">
        <!-- Шапка -->
        <header class="header">
            <div class="logo">E-BANK</div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt-fast"></i> Дашборд
                </button>
                <button class="nav-tab" onclick="showSection('bank')">
                    <i class="fas fa-university"></i> Банк
                </button>
                <button class="nav-tab" onclick="showSection('clicker')">
                    <i class="fas fa-mouse-pointer"></i> Кликер
                </button>
                <button class="nav-tab" onclick="showSection('crypto')">
                    <i class="fas fa-bitcoin"></i> Крипта
                </button>
                <button class="nav-tab" onclick="showSection('credits')">
                    <i class="fas fa-hand-holding-usd"></i> Кредиты
                </button>
                <button class="nav-tab" onclick="showSection('leaderboard')">
                    <i class="fas fa-trophy"></i> Лидерборд
                </button>
                <button class="nav-tab" onclick="showSection('history')">
                    <i class="fas fa-history"></i> История
                </button>
                <button class="nav-tab" onclick="showSection('admin')" id="adminTab" style="display: none;">
                    <i class="fas fa-crown"></i> Админка
                </button>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-power-off"></i> Выход
            </button>
        </header>

        <!-- Контент -->
        <div class="container">
            <!-- Дашборд -->
            <section id="dashboardSection" class="section active">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt-fast"></i> Панель управления
                </h2>

                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-wallet"></i> Баланс
                        </div>
                        <div class="stat-value" id="balanceStat">0 ₽</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-chart-line"></i> Уровень
                        </div>
                        <div class="stat-value" id="levelStat">1</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-mouse"></i> Кликов
                        </div>
                        <div class="stat-value" id="clicksStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-bolt"></i> Сила клика
                        </div>
                        <div class="stat-value" id="powerStat">1 ₽</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-coins"></i> Всего заработано
                        </div>
                        <div class="stat-value" id="totalEarnedStat">0 ₽</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">
                            <i class="fas fa-fire"></i> Daily Streak
                        </div>
                        <div class="stat-value" id="streakStat">0 дней</div>
                    </div>
                </div>

                <div class="function-grid">
                    <!-- Быстрый перевод -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h3 class="function-title">Быстрый перевод</h3>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-input" id="quickToLogin" placeholder="Логин получателя">
                        </div>
                        <div class="form-group">
                            <input type="number" class="form-input" id="quickAmount" placeholder="Сумма ₽" min="1">
                        </div>
                        <button class="btn" onclick="quickTransfer()">
                            <i class="fas fa-paper-plane"></i> Отправить
                        </button>
                    </div>

                    <!-- Ежедневный бонус -->
                    <div class="function-card" id="dailyBonusCard">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <h3 class="function-title">Ежедневный бонус</h3>
                        </div>
                        <div style="text-align: center; padding: 30px 0;">
                            <div id="bonusTimer" style="font-size: 2rem; color: var(--primary); margin-bottom: 15px;">
                                <i class="fas fa-clock"></i> Доступно
                            </div>
                            <div id="streakInfo" style="color: #aaa; margin-bottom: 20px;">
                                Streak: <span id="currentStreak">0</span> дней
                            </div>
                        </div>
                        <button class="btn" onclick="claimDailyBonus()" id="bonusBtn">
                            <i class="fas fa-gift"></i> Получить бонус
                        </button>
                    </div>

                    <!-- Лотерея -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-dice"></i>
                            </div>
                            <h3 class="function-title">Кибер-лотерея</h3>
                        </div>
                        <div style="text-align: center; padding: 20px 0;">
                            <div style="font-size: 1.5rem; color: var(--warning); margin-bottom: 15px;">
                                <i class="fas fa-ticket-alt"></i> Билеты: <span id="ticketCount">0</span>
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 20px;">
                                1 билет = 100₽ • Джекпот: 10,000₽
                            </div>
                            <div class="form-group">
                                <input type="number" class="form-input" id="lotteryTickets"
                                    placeholder="Количество билетов" min="1" max="10" value="1">
                            </div>
                            <button class="btn" onclick="buyLotteryTickets()" style="margin-bottom: 10px;">
                                <i class="fas fa-shopping-cart"></i> Купить билеты
                            </button>
                            <button class="btn" onclick="playLottery()"
                                style="background: linear-gradient(135deg, var(--warning), #ff6600);">
                                <i class="fas fa-dice"></i> Испытать удачу
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Банк -->
            <section id="bankSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-university"></i> Банковские операции
                </h2>

                <div class="function-grid">
                    <!-- Переводы -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h3 class="function-title">Переводы</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Логин получателя</label>
                            <input type="text" class="form-input" id="transferToLogin" placeholder="Введите логин">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Сумма (₽)</label>
                            <input type="number" class="form-input" id="transferAmount" placeholder="Только целые числа"
                                min="1">
                        </div>
                        <button class="btn" onclick="makeTransfer()">
                            <i class="fas fa-paper-plane"></i> Отправить перевод
                        </button>
                    </div>

                    <!-- Карты -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <h3 class="function-title">Мои карты</h3>
                        </div>
                        <div id="cardsList" style="min-height: 150px; margin-bottom: 20px;"></div>
                        <button class="btn" onclick="createCard()">
                            <i class="fas fa-plus-circle"></i> Создать новую карту
                        </button>
                    </div>

                    <!-- Вклады -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3 class="function-title">Мои вклады</h3>
                        </div>
                        <div id="depositsList" style="min-height: 150px; margin-bottom: 20px;"></div>
                        <div class="form-group">
                            <label class="form-label">Сумма вклада (₽)</label>
                            <input type="number" class="form-input" id="depositAmount" placeholder="Минимум 1 ₽"
                                min="1">
                        </div>
                        <button class="btn" onclick="createDeposit()">
                            <i class="fas fa-piggy-bank"></i> Создать вклад
                        </button>
                    </div>
                </div>
            </section>

            <!-- Кликер -->
            <!-- Кликер -->
            <section id="clickerSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-mouse-pointer"></i> Кликер-арена
                </h2>

                <div class="clicker-container">
                    <button class="click-button" onclick="clickHandler()" id="clickButton">
                        <i class="fas fa-hand-pointer"></i>
                        <span>КЛИК!</span>
                        <div style="font-size: 1rem; margin-top: 10px;">+<span id="clickPowerValue">1</span>₽ за клик
                        </div>
                    </button>
                    <div class="clicker-stats">
                        <div class="clicker-stat">
                            <div class="clicker-stat-label">Всего кликов</div>
                            <div class="clicker-stat-value" id="totalClicks">0</div>
                        </div>
                        <div class="clicker-stat">
                            <div class="clicker-stat-label">За клик</div>
                            <div class="clicker-stat-value" id="clickPower">1 ₽</div>
                        </div>
                        <div class="clicker-stat">
                            <div class="clicker-stat-label">Уровень</div>
                            <div class="clicker-stat-value" id="level">1</div>
                        </div>
                        <div class="clicker-stat">
                            <div class="clicker-stat-label">Опыт</div>
                            <div class="clicker-stat-value" id="exp">0/<span id="expNeeded">100</span></div>
                        </div>
                    </div>
                    <div style="margin-top: 30px; color: #aaa; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Прогресс уровня:
                        <div
                            style="width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin-top: 10px;">
                            <div id="expBar"
                                style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 5px; transition: width 0.5s;">
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="section-title" style="font-size: 1.8rem; margin: 40px 0 20px 0;">
                    <i class="fas fa-rocket"></i> Улучшения
                </h3>
                <div class="function-grid">
                    <!-- Усиление клика -->
                    <div class="function-card" onclick="buyUpgrade('power')" id="powerClickerCard">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h3 class="function-title">Усилить клик</h3>
                        </div>
                        <div style="margin: 20px 0;">
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 10px;">
                                Увеличивает доход с каждого клика на <span style="color: var(--success);">+2₽</span>
                            </div>
                            <div style="color: var(--primary); font-size: 1.8rem; font-weight: bold; margin: 15px 0;">
                                <i class="fas fa-coins"></i> 100 ₽
                            </div>
                            <div style="color: #888; font-size: 0.8rem;">
                                Текущая сила: <span id="currentPower">1</span>₽
                            </div>
                        </div>
                        <div
                            style="color: #aaa; font-size: 0.8rem; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-top: 15px;">
                            <i class="fas fa-info-circle"></i> Кликайте на карточку для покупки
                        </div>
                    </div>

                    <!-- Авто-кликер -->
                    <div class="function-card" onclick="buyUpgrade('auto')" id="autoClickerCard">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="function-title">Авто-кликер</h3>
                        </div>
                        <div style="margin: 20px 0; text-align: center;">
                            <div id="autoClickerStatus">
                                <div style="color: var(--danger); font-size: 1.2rem; margin-bottom: 15px;">
                                    <i class="fas fa-times-circle"></i> Не куплено
                                </div>
                                <div
                                    style="color: var(--primary); font-size: 1.8rem; font-weight: bold; margin: 15px 0;">
                                    <i class="fas fa-coins"></i> 500 ₽
                                </div>
                                <div style="color: #aaa; font-size: 0.9rem;">
                                    Автоматические клики каждые 10 секунд
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Крипто -->
            <section id="cryptoSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-bitcoin"></i> Крипто-трейдинг
                </h2>

                <h3 style="color: var(--secondary); margin-bottom: 20px; font-size: 1.5rem;">
                    <i class="fas fa-chart-line"></i> Текущие курсы
                </h3>
                <div class="function-grid" id="cryptoPrices">
                    <!-- Курсы загружаются динамически -->
                </div>

                <div class="function-grid" style="margin-top: 40px;">
                    <!-- Покупка -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <h3 class="function-title">Покупка крипты</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Криптовалюта</label>
                            <select class="form-input" id="buyCoin" onchange="updateCryptoPriceFields()">
                                <option value="BTC">Bitcoin (BTC)</option>
                                <option value="ETH">Ethereum (ETH)</option>
                                <option value="DOGE">Dogecoin (DOGE)</option>
                                <option value="SOL">Solana (SOL)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Количество</label>
                            <input type="number" class="form-input" id="buyAmount" placeholder="0.001" step="0.001"
                                min="0.001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Цена за единицу (₽)</label>
                            <input type="number" class="form-input" id="buyPrice" readonly>
                        </div>
                        <div
                            style="background: rgba(0, 255, 136, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                            <div style="color: var(--primary); font-weight: bold; text-align: center;">
                                Итого: <span id="buyTotal">0</span> ₽
                            </div>
                        </div>
                        <button class="btn" onclick="buyCrypto()">
                            <i class="fas fa-shopping-cart"></i> Купить криптовалюту
                        </button>
                    </div>

                    <!-- Продажа -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-cash-register"></i>
                            </div>
                            <h3 class="function-title">Продажа крипты</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Криптовалюта</label>
                            <select class="form-input" id="sellCoin" onchange="updateSellForm()">
                                <option value="">Выберите крипту</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Доступно</label>
                            <input type="text" class="form-input" id="sellAvailable" readonly placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Количество</label>
                            <input type="number" class="form-input" id="sellAmount" placeholder="0.001" step="0.001"
                                min="0.001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Цена за единицу (₽)</label>
                            <input type="number" class="form-input" id="sellPrice" readonly>
                        </div>
                        <div
                            style="background: rgba(255, 0, 0, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                            <div style="color: var(--danger); font-weight: bold; text-align: center;">
                                Итого: <span id="sellTotal">0</span> ₽
                            </div>
                        </div>
                        <button class="btn" onclick="sellCrypto()"
                            style="background: linear-gradient(135deg, var(--danger), #ff0000);">
                            <i class="fas fa-cash-register"></i> Продать криптовалюту
                        </button>
                    </div>

                    <!-- Портфель -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <h3 class="function-title">Мой портфель</h3>
                        </div>
                        <div id="cryptoPortfolio" style="min-height: 200px;">
                            <div style="color: #aaa; text-align: center; padding: 40px;">
                                <i class="fas fa-coins"
                                    style="font-size: 3rem; margin-bottom: 20px; display: block; color: #555;"></i>
                                Портфель пуст
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Кредиты -->
            <section id="creditsSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-hand-holding-usd"></i> Кредитная система
                </h2>

                <div class="function-grid">
                    <!-- Взять кредит -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3 class="function-title">Взять кредит</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Сумма кредита (₽)</label>
                            <input type="number" class="form-input" id="creditAmount" placeholder="От 1 до 100,000 ₽"
                                min="1" max="100000" oninput="updateCreditTotal()">
                        </div>
                        <div
                            style="background: rgba(255, 170, 0, 0.15); padding: 20px; border-radius: 12px; margin: 25px 0; border: 1px solid rgba(255, 170, 0, 0.3);">
                            <div style="color: var(--warning); font-size: 1.1rem; margin-bottom: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> Процентная ставка: 10%
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">
                                К получению: <span id="creditReceive">0</span> ₽
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">
                                К возврату: <span id="creditTotal">0</span> ₽
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem;">
                                Срок: <span id="creditTerm">30 дней</span>
                            </div>
                        </div>
                        <button class="btn" onclick="takeCredit()">
                            <i class="fas fa-file-contract"></i> Взять кредит
                        </button>
                    </div>

                    <!-- Мои кредиты -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <h3 class="function-title">Мои кредиты</h3>
                        </div>
                        <div id="creditsList" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                            <div style="color: #aaa; text-align: center; padding: 40px;">
                                <i class="fas fa-hand-holding-usd"
                                    style="font-size: 3rem; margin-bottom: 20px; display: block; color: #555;"></i>
                                Активных кредитов нет
                            </div>
                        </div>
                    </div>

                    <!-- Погашение -->
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon">
                                <i class="fas fa-money-check-alt"></i>
                            </div>
                            <h3 class="function-title">Погашение кредита</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Выберите кредит</label>
                            <select class="form-input" id="payCreditSelect" onchange="updateCreditInfo()">
                                <option value="">Выберите кредит</option>
                            </select>
                        </div>
                        <div id="creditInfo" style="margin: 25px 0;">
                            <div
                                style="background: rgba(255, 85, 85, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 85, 85, 0.3); text-align: center;">
                                <div style="color: var(--danger); font-size: 1.2rem; margin-bottom: 10px;">
                                    <i class="fas fa-exclamation-circle"></i> Кредит не выбран
                                </div>
                                <div style="color: #aaa; font-size: 0.9rem;">
                                    Выберите кредит для погашения
                                </div>
                            </div>
                        </div>
                        <button class="btn" onclick="payCredit()">
                            <i class="fas fa-check-circle"></i> Погасить кредит
                        </button>
                    </div>
                </div>
            </section>

            <!-- Лидерборд -->
            <section id="leaderboardSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-trophy"></i> Лидерборд
                </h2>

                <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
                    <button class="btn btn-info" onclick="loadLeaderboard('balance')" id="lbBalance">
                        <i class="fas fa-coins"></i> По балансу
                    </button>
                    <button class="btn btn-info" onclick="loadLeaderboard('level')" id="lbLevel">
                        <i class="fas fa-chart-line"></i> По уровню
                    </button>
                    <button class="btn btn-info" onclick="loadLeaderboard('clicks')" id="lbClicks">
                        <i class="fas fa-mouse"></i> По кликам
                    </button>
                    <button class="btn btn-info" onclick="loadLeaderboard('total')" id="lbTotal">
                        <i class="fas fa-trophy"></i> По заработку
                    </button>
                </div>
                <div id="leaderboardContent">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Позиция</th>
                                <th>Игрок</th>
                                <th>Баланс</th>
                                <th>Уровень</th>
                                <th>Клики</th>
                                <th>Заработано</th>
                                <th>Статус</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #aaa;">
                                    <i class="fas fa-users"
                                        style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                    Лидерборд загружается...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 40px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        <i class="fas fa-medal"></i> Моя позиция
                    </h3>
                    <div id="myPosition"
                        style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 136, 255, 0.1)); padding: 20px; border-radius: 15px; border: 1px solid rgba(0, 255, 136, 0.3);">
                        Загрузка...
                    </div>
                </div>
            </section>

            <!-- История -->
            <section id="historySection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-history"></i> История операций
                </h2>

                <div style="margin-bottom: 30px;">
                    <div class="tabs" style="max-width: 500px;">
                        <button class="tab active" onclick="filterHistory('all')">Все</button>
                        <button class="tab" onclick="filterHistory('transfer')">Переводы</button>
                        <button class="tab" onclick="filterHistory('click')">Клики</button>
                        <button class="tab" onclick="filterHistory('crypto')">Крипта</button>
                        <button class="tab" onclick="filterHistory('deposit')">Вклады</button>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Дата и время</th>
                            <th>Тип операции</th>
                            <th>Сумма</th>
                            <th>Детали</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #aaa;">
                                <i class="fas fa-history"
                                    style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                История операций загружается...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn" onclick="loadMoreHistory()" id="loadMoreBtn"
                    style="margin-top: 30px; display: none;">
                    <i class="fas fa-sync-alt"></i> Загрузить ещё
                </button>
            </section>

            <!-- Админ-панель -->
            <section id="adminSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-crown"></i> Админ-панель (Властелин ILIA)
                </h2>

                <div
                    style="background: linear-gradient(135deg, rgba(255, 0, 136, 0.2), rgba(136, 0, 255, 0.2)); padding: 30px; border-radius: 20px; border: 2px solid var(--accent); margin-bottom: 30px; animation: neonPulse 3s infinite;">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                        <div style="font-size: 3rem;">👑</div>
                        <div>
                            <h3 style="color: var(--accent); margin-bottom: 5px;">Властелин ILIA</h3>
                            <p style="color: #aaa; font-size: 0.9rem;">Вы обладаете абсолютной властью над системой</p>
                        </div>
                    </div>
                </div>

                <div class="tabs" style="margin-bottom: 30px;">
                    <button class="tab active" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i> Все пользователи
                    </button>
                    <button class="tab" onclick="showAdminTab('fullUsers')">
                        <i class="fas fa-key"></i> Все пользователи (с паролями)
                    </button>
                    <button class="tab" onclick="showAdminTab('deleted')">
                        <i class="fas fa-user-slash"></i> Удаленные
                    </button>
                    <button class="tab" onclick="showAdminTab('stats')">
                        <i class="fas fa-chart-bar"></i> Статистика
                    </button>
                    <button class="tab" onclick="showAdminTab('actions')">
                        <i class="fas fa-cogs"></i> Действия
                    </button>
                </div>

                <!-- Все пользователи -->
                <div id="adminUsersTab" class="admin-tab active">
                    <h3 style="color: var(--primary); margin: 0 0 20px 0;">
                        <i class="fas fa-users"></i> Список пользователей
                    </h3>

                    <div class="search-container">
                        <input type="text" class="form-input" id="userSearch" placeholder="Поиск по логину/имени"
                            oninput="searchUsers()">
                        <input type="number" class="form-input" id="minBalance" placeholder="Мин. баланс"
                            style="width: 150px;" oninput="searchUsers()">
                        <input type="number" class="form-input" id="maxBalance" placeholder="Макс. баланс"
                            style="width: 150px;" oninput="searchUsers()">
                    </div>

                    <div id="usersList" style="min-height: 300px;"></div>
                </div>

                <!-- Все пользователи с паролями -->
                <div id="adminFullUsersTab" class="admin-tab">
                    <h3 style="color: var(--danger); margin: 0 0 20px 0;">
                        <i class="fas fa-key"></i> Все пользователи (с паролями)
                    </h3>

                    <div class="search-container">
                        <input type="text" class="form-input" id="fullUserSearch" placeholder="Поиск по логину/имени"
                            oninput="searchFullUsers()">
                        <button class="btn btn-sm" onclick="loadAllUsersWithPasswords()">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                    </div>

                    <div class="users-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Логин</th>
                                    <th>Пароль (хеш)</th>
                                    <th>Имя</th>
                                    <th>Баланс</th>
                                    <th>Уровень</th>
                                    <th>Зарегистрирован</th>
                                </tr>
                            </thead>
                            <tbody id="fullUsersList">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #aaa;">
                                        <i class="fas fa-spinner fa-spin"></i> Загрузка...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="color: #aaa; font-size: 0.9rem; margin-top: 15px; text-align: center;">
                        <i class="fas fa-info-circle"></i> Пароли хранятся в хешированном виде для безопасности
                    </div>
                </div>

                <!-- Удаленные пользователи -->
                <div id="adminDeletedTab" class="admin-tab">
                    <h3 style="color: var(--danger); margin: 0 0 20px 0;">
                        <i class="fas fa-user-slash"></i> Удаленные пользователи
                    </h3>
                    <div id="deletedUsersList" style="min-height: 300px;">
                        <div style="color: #aaa; text-align: center; padding: 40px;">
                            <i class="fas fa-trash" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                            Нет удаленных пользователей
                        </div>
                    </div>
                </div>

                <!-- Статистика -->
                <div id="adminStatsTab" class="admin-tab">
                    <div class="function-card">
                        <div class="function-header">
                            <div class="function-icon"
                                style="background: linear-gradient(135deg, var(--accent), #ff5500);">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h3 class="function-title">Статистика системы</h3>
                        </div>
                        <div id="adminStats" style="min-height: 200px;">
                            <div style="color: #aaa; text-align: center; padding: 40px;">
                                <i class="fas fa-chart-line" style="font-size: 2rem;"></i>
                                <div>Загрузка статистики...</div>
                            </div>
                        </div>
                        <button class="btn" onclick="loadAdminStats()" style="margin-top: 15px;">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                    </div>
                </div>

                <!-- Действия -->
                <div id="adminActionsTab" class="admin-tab">
                    <div class="function-grid">
                        <!-- Управление балансом -->
                        <div class="function-card">
                            <div class="function-header">
                                <div class="function-icon"
                                    style="background: linear-gradient(135deg, #00ff88, #00cc66);">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <h3 class="function-title">Управление балансом</h3>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Логин пользователя</label>
                                <input type="text" class="form-input" id="adminUserLogin" placeholder="Введите логин">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Сумма</label>
                                <input type="number" class="form-input" id="adminAmount" placeholder="Сумма ₽" min="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Операция</label>
                                <select class="form-input" id="adminOperation">
                                    <option value="add">Добавить</option>
                                    <option value="set">Установить</option>
                                </select>
                            </div>
                            <button class="btn" onclick="adminUpdateBalance()">
                                <i class="fas fa-magic"></i> Изменить баланс
                            </button>
                        </div>

                        <!-- Удаление пользователя -->
                        <div class="function-card">
                            <div class="function-header">
                                <div class="function-icon"
                                    style="background: linear-gradient(135deg, #ff5555, #cc0000);">
                                    <i class="fas fa-user-slash"></i>
                                </div>
                                <h3 class="function-title">Удаление пользователей</h3>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ID пользователя для удаления</label>
                                <input type="number" class="form-input" id="deleteUserId"
                                    placeholder="Введите ID пользователя" min="2">
                                <small style="color: #aaa; display: block; margin-top: 5px;">
                                    ID 1 (админ) нельзя удалить
                                </small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Подтверждение</label>
                                <input type="text" class="form-input" id="deleteConfirm"
                                    placeholder="Введите 'УДАЛИТЬ' для подтверждения">
                            </div>
                            <button class="btn btn-danger" onclick="deleteUser()">
                                <i class="fas fa-trash"></i> Удалить пользователя
                            </button>
                        </div>

                        <!-- Массовые операции -->
                        <div class="function-card">
                            <div class="function-header">
                                <div class="function-icon"
                                    style="background: linear-gradient(135deg, #0088ff, #0055cc);">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3 class="function-title">Массовые операции</h3>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Сумма каждому</label>
                                <input type="number" class="form-input" id="massAmount" placeholder="Сумма ₽" min="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Сообщение</label>
                                <input type="text" class="form-input" id="massMessage" placeholder="Причина начисления">
                            </div>
                            <button class="btn" onclick="adminMassGive()" style="margin-bottom: 10px;">
                                <i class="fas fa-gift"></i> Начислить всем
                            </button>
                            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                                <button class="btn" onclick="adminResetLeaderboard('balance')"
                                    style="background: linear-gradient(135deg, #ffaa00, #ff7700); margin-bottom: 5px;">
                                    <i class="fas fa-undo"></i> Сбросить балансы
                                </button>
                                <button class="btn" onclick="adminResetLeaderboard('all')"
                                    style="background: linear-gradient(135deg, #ff5555, #ff0000);">
                                    <i class="fas fa-trash"></i> Полный сброс
                                </button>
                            </div>
                        </div>

                        <!-- Логи админа -->
                        <div class="function-card">
                            <div class="function-header">
                                <div class="function-icon"
                                    style="background: linear-gradient(135deg, #5555ff, #3333cc);">
                                    <i class="fas fa-scroll"></i>
                                </div>
                                <h3 class="function-title">Логи админ-действий</h3>
                            </div>
                            <div id="adminLogs" style="max-height: 300px; overflow-y: auto; margin-bottom: 15px;">
                                <div style="color: #aaa; text-align: center; padding: 40px;">
                                    <i class="fas fa-history"></i>
                                    <div>Загрузка логов...</div>
                                </div>
                            </div>
                            <button class="btn" onclick="loadAdminLogs()">
                                <i class="fas fa-eye"></i> Показать логи
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Частицы для кликера -->
    <div id="particles"></div>

    <script>
        // ====== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ======
        let token = localStorage.getItem('ebank_token');
        let userData = null;
        let historyLastId = null;
        let historyHasMore = false;
        let historyFilter = 'all';
        let autoRefreshInterval = null;
        let cryptoPrices = {};
        let autoClickerInterval = null;
        let cryptoPriceUpdateInterval = null;
        let leaderboardType = 'balance';
        let userPortfolio = {};

        // ====== УЛУЧШЕННЫЕ УВЕДОМЛЕНИЯ ======
        function showNotification(text, type = 'info', title = 'Уведомление') {
            const container = document.getElementById('notificationContainer');
            const notificationId = 'notif_' + Date.now();

            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification notification-${type}`;

            // Выбор иконки в зависимости от типа
            let icon = 'fas fa-info-circle';
            let emoji = '';

            switch (type) {
                case 'success':
                    icon = 'fas fa-check-circle';
                    emoji = '🎉';
                    break;
                case 'error':
                    icon = 'fas fa-exclamation-circle';
                    emoji = '❌';
                    break;
                case 'warning':
                    icon = 'fas fa-exclamation-triangle';
                    emoji = '⚠️';
                    break;
                case 'special':
                    icon = 'fas fa-crown';
                    emoji = '👑';
                    break;
            }

            notification.innerHTML = `
                <div class="notification-icon">${emoji} <i class="${icon}"></i></div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-text">${text}</div>
                </div>
                <button class="notification-close" onclick="closeNotification('${notificationId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;

            container.appendChild(notification);

            // Анимация появления
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Автоматическое закрытие через 5 секунд
            setTimeout(() => {
                closeNotification(notificationId);
            }, 5000);
        }

        function closeNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.classList.remove('show');
                notification.classList.add('hiding');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 400);
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU').format(Math.floor(amount)) + ' ₽';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);

            if (diffSec < 60) {
                return 'только что';
            } else if (diffMin < 60) {
                return `${diffMin} мин. назад`;
            } else if (diffHour < 24) {
                return `${diffHour} ч. назад`;
            } else if (diffDay === 1) {
                return 'вчера';
            } else if (diffDay < 7) {
                return `${diffDay} дн. назад`;
            } else {
                return date.toLocaleString('ru-RU');
            }
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU');
        }

        function createParticle(x, y, amount = 1) {
            const particles = document.getElementById('particles');

            for (let i = 0; i < amount; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.width = '10px';
                particle.style.height = '10px';
                particle.style.background = `radial-gradient(circle, ${Math.random() > 0.5 ? '#00ff88' : '#0088ff'} 0%, transparent 70%)`;
                particle.style.borderRadius = '50%';
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '99999';

                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const duration = 500 + Math.random() * 500;

                particle.animate([
                    {
                        transform: `translate(0, 0) scale(1)`,
                        opacity: 1
                    },
                    {
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`,
                        opacity: 0
                    }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });

                particles.appendChild(particle);
                setTimeout(() => particle.remove(), duration);
            }
        }

        // ====== API ФУНКЦИИ ======
        async function apiCall(url, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                const response = await fetch(url, {
                    method: options.method || 'GET',
                    headers: headers,
                    body: options.body ? JSON.stringify(options.body) : undefined
                });

                if (!response.ok) {
                    const error = await response.json().catch(() => ({ error: 'Ошибка сети' }));
                    throw new Error(error.error || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // ====== АУТЕНТИФИКАЦИЯ ======
        function showAuthTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

            const tabButton = document.querySelector(`.tab[onclick*="${tab}"]`);
            const form = document.getElementById(`${tab}Form`);

            if (tabButton && form) {
                tabButton.classList.add('active');
                form.classList.add('active');
            }
        }

        async function login(event) {
            event.preventDefault();

            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            const btn = event.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Вход...';
            btn.disabled = true;

            try {
                const data = await apiCall('/api/login', {
                    method: 'POST',
                    body: { login: username, password }
                });

                token = data.token;
                localStorage.setItem('ebank_token', token);
                userData = data;

                if (username === 'ILIA') {
                    showNotification('🔥 ДОБРО ПОЖАЛОВАТЬ, ВЛАСТЕЛИН! 🔥', 'special', 'СЕКРЕТНЫЙ ДОСТУП');
                    document.getElementById('adminTab').style.display = 'flex';
                } else {
                    showNotification('Успешный вход! Добро пожаловать в E-BANK 2.0 ULTRA!', 'success', 'Вход выполнен');
                }

                showMainApp();

            } catch (error) {
                showNotification(error.message || 'Ошибка входа', 'error', 'Ошибка');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function register(event) {
            event.preventDefault();

            const username = document.getElementById('registerUsername').value.trim();
            const name = document.getElementById('registerName').value.trim();
            const password = document.getElementById('registerPassword').value;

            if (username.length < 3) {
                showNotification('Логин должен быть не менее 3 символов', 'error', 'Ошибка');
                return;
            }

            if (password.length < 6) {
                showNotification('Пароль должен быть не менее 6 символов', 'error', 'Ошибка');
                return;
            }

            const btn = event.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Создание...';
            btn.disabled = true;

            try {
                const data = await apiCall('/api/register', {
                    method: 'POST',
                    body: { login: username, password, name }
                });

                token = data.token;
                localStorage.setItem('ebank_token', token);
                userData = data;

                showNotification(data.message || 'Аккаунт успешно создан!', 'success', 'Регистрация');
                showMainApp();

            } catch (error) {
                showNotification(error.message || 'Ошибка регистрации', 'error', 'Ошибка');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ====== ОСНОВНОЙ ИНТЕРФЕЙС ======
        function showMainApp() {
            document.getElementById('authApp').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';

            loadUserData();
            loadCards();
            loadDeposits();
            loadCredits();
            loadCryptoData();
            loadHistory();
            loadLeaderboard(leaderboardType);
            startAutoRefresh();

            if (cryptoPriceUpdateInterval) clearInterval(cryptoPriceUpdateInterval);
            cryptoPriceUpdateInterval = setInterval(loadCryptoPrices, 30000);

            updateDailyBonus();
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            const section = document.getElementById(`${sectionId}Section`);
            const tab = document.querySelector(`.nav-tab[onclick*="${sectionId}"]`);

            if (section) {
                section.classList.add('active');
            }

            if (tab) {
                tab.classList.add('active');
            }

            if (sectionId === 'leaderboard') {
                loadLeaderboard(leaderboardType);
            } else if (sectionId === 'admin') {
                loadAdminStats();
                loadAdminLogs();
                searchUsers();
                loadAllUsersWithPasswords();
            }
        }

        // ====== АДМИН ПАНЕЛЬ ======
        function showAdminTab(tab) {
            document.querySelectorAll('#adminSection .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab').forEach(at => at.classList.remove('active'));

            const tabButton = document.querySelector(`#adminSection .tab[onclick*="${tab}"]`);
            const tabContent = document.getElementById(`admin${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`);

            if (tabButton) tabButton.classList.add('active');
            if (tabContent) tabContent.classList.add('active');

            if (tab === 'fullUsers') {
                loadAllUsersWithPasswords();
            } else if (tab === 'deleted') {
                loadDeletedUsers();
            } else if (tab === 'stats') {
                loadAdminStats();
            } else if (tab === 'actions') {
                loadAdminLogs();
            }
        }

        // ====== ЗАГРУЗКА ДАННЫХ ======
        async function loadUserData() {
            try {
                const data = await apiCall('/api/me');
                userData = { ...userData, ...data };

                document.getElementById('balanceStat').textContent = formatCurrency(data.balance);
                document.getElementById('levelStat').textContent = data.level;
                document.getElementById('clicksStat').textContent = data.clicks;
                document.getElementById('powerStat').textContent = data.click_power + ' ₽';
                document.getElementById('totalEarnedStat').textContent = formatCurrency(data.total_earned || 0);
                document.getElementById('streakStat').textContent = (data.daily_streak || 0) + ' дней';

                document.getElementById('totalClicks').textContent = data.clicks;
                document.getElementById('clickPower').textContent = data.click_power + ' ₽';
                document.getElementById('clickPowerValue').textContent = data.click_power;
                document.getElementById('level').textContent = data.level;
                document.getElementById('exp').textContent = data.exp;
                document.getElementById('expNeeded').textContent = data.level * 100;

                const expPercent = Math.min((data.exp / (data.level * 100)) * 100, 100);
                document.getElementById('expBar').style.width = expPercent + '%';

                document.getElementById('currentPower').textContent = data.click_power;

                updateAutoClickerStatus(data.auto_clicker);
                document.getElementById('ticketCount').textContent = data.lottery_tickets || 0;

                if (data.login === 'ILIA') {
                    document.querySelector('.logo').innerHTML = 'E-BANK <span style="color: var(--accent); text-shadow: 0 0 10px var(--accent);">GOD</span>';
                }

            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
                if (error.message === 'Недействительный токен') {
                    logout();
                }
            }
        }

        function updateAutoClickerStatus(status) {
            const autoCard = document.getElementById('autoClickerCard');
            const statusDiv = document.getElementById('autoClickerStatus');

            if (status === 1) {
                statusDiv.innerHTML = `
                    <div style="color: var(--success); font-size: 1.2rem; margin-bottom: 15px;">
                        <i class="fas fa-check-circle"></i> Активен!
                    </div>
                    <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 10px;">
                        Автокликер работает
                    </div>
                    <div style="color: var(--primary); font-size: 0.8rem;">
                        <i class="fas fa-sync-alt"></i> Клики каждые 10 секунд
                    </div>
                `;
                autoCard.style.opacity = '0.7';
                autoCard.style.cursor = 'default';
                autoCard.onclick = null;
                startAutoClicker();
            } else {
                statusDiv.innerHTML = `
                    <div style="color: var(--danger); font-size: 1.2rem; margin-bottom: 15px;">
                        <i class="fas fa-times-circle"></i> Не куплено
                    </div>
                    <div style="color: var(--primary); font-size: 1.8rem; font-weight: bold; margin: 15px 0;">
                        <i class="fas fa-coins"></i> 500 ₽
                    </div>
                    <div style="color: #aaa; font-size: 0.9rem;">
                        Автоматические клики каждые 10 секунд
                    </div>
                `;
                autoCard.style.opacity = '1';
                autoCard.style.cursor = 'pointer';
                autoCard.onclick = () => buyUpgrade('auto');
            }
        }

        // ====== КЛИКЕР ======
        async function clickHandler() {
            const btn = document.getElementById('clickButton');

            // Анимация клика
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
            }, 100);

            // Создаем частицы
            const rect = btn.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            createParticle(centerX, centerY, 5);

            try {
                const data = await apiCall('/api/click', { method: 'POST' });

                // Показываем всплывающее уведомление
                showClickNotification(`+${data.earned}₽`, centerX, centerY);

                if (data.leveledUp) {
                    showNotification(`🎉 Новый уровень! ${data.level - 1} → ${data.level}`, 'success', 'Повышение уровня!');
                }

                loadUserData();
                loadHistory();

                // Создаем дополнительные частицы для заработка
                createParticle(centerX, centerY, Math.min(data.earned, 10));

            } catch (error) {
                showNotification(error.message || 'Ошибка клика', 'error', 'Ошибка');
            }
        }

        function showClickNotification(text, x, y) {
            const notification = document.createElement('div');
            notification.textContent = text;
            notification.style.position = 'fixed';
            notification.style.left = `${x}px`;
            notification.style.top = `${y}px`;
            notification.style.color = '#00ff88';
            notification.style.fontWeight = 'bold';
            notification.style.fontSize = '1.2rem';
            notification.style.textShadow = '0 0 10px #00ff88';
            notification.style.pointerEvents = 'none';
            notification.style.zIndex = '99999';
            notification.style.transform = 'translate(-50%, -50%)';

            document.body.appendChild(notification);

            notification.animate([
                {
                    opacity: 1,
                    transform: 'translate(-50%, -50%) scale(1)'
                },
                {
                    opacity: 0,
                    transform: 'translate(-50%, -100px) scale(0.5)'
                }
            ], {
                duration: 1000,
                easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
            });

            setTimeout(() => notification.remove(), 1000);
        }

        function startAutoClicker() {
            if (autoClickerInterval) clearInterval(autoClickerInterval);

            autoClickerInterval = setInterval(async () => {
                if (userData && userData.balance > 0 && userData.auto_clicker === 1) {
                    try {
                        await apiCall('/api/click', { method: 'POST' });
                        loadUserData();

                        // Визуализация авто-кликера
                        const btn = document.getElementById('clickButton');
                        const rect = btn.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        createParticle(centerX, centerY, 3);

                    } catch (error) {
                        console.error('Авто-кликер ошибка:', error);
                    }
                }
            }, 10000);
        }

        // ====== ЕЖЕДНЕВНЫЙ БОНУС ======
        function updateDailyBonus() {
            const today = new Date();
            const lastDaily = userData?.last_daily ? new Date(userData.last_daily) : null;
            const btn = document.getElementById('bonusBtn');
            const timer = document.getElementById('bonusTimer');
            const currentStreak = document.getElementById('currentStreak');

            if (userData) {
                currentStreak.textContent = userData.daily_streak || 0;
            }

            if (lastDaily && lastDaily.toDateString() === today.toDateString()) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Бонус получен';

                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);

                const diffMs = tomorrow - today;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

                timer.innerHTML = `<i class="fas fa-clock"></i> Через ${diffHours}ч ${diffMinutes}м`;
            } else {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-gift"></i> Получить бонус';
                timer.innerHTML = '<i class="fas fa-gift"></i> Доступно сейчас!';
            }
        }

        async function claimDailyBonus() {
            try {
                const data = await apiCall('/api/daily-bonus', {
                    method: 'POST'
                });

                showNotification(data.message, 'success', 'Ежедневный бонус');
                loadUserData();
                updateDailyBonus();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка получения бонуса', 'error', 'Ошибка');
            }
        }

        // ====== УЛУЧШЕНИЯ ======
        async function buyUpgrade(type) {
            try {
                const data = await apiCall('/api/upgrade', {
                    method: 'POST',
                    body: { type }
                });

                showNotification(data.message, 'success', 'Улучшение куплено');
                loadUserData();
                loadHistory();

                if (type === 'auto') {
                    updateAutoClickerStatus(1);
                }

                // Анимация покупки - ищем элемент по ID или селектору
                let card;
                if (type === 'power') {
                    card = document.querySelector('.function-card[onclick*="power"]');
                } else if (type === 'auto') {
                    card = document.getElementById('autoClickerCard');
                }

                if (card) {
                    card.style.animation = 'none';
                    setTimeout(() => {
                        card.style.animation = 'purchaseGlow 0.5s';
                    }, 10);
                }

            } catch (error) {
                showNotification(error.message || 'Ошибка покупки', 'error', 'Ошибка');
            }
        }
        // ====== ПЕРЕВОДЫ ======
        async function quickTransfer() {
            const toLogin = document.getElementById('quickToLogin').value.trim();
            const amount = parseInt(document.getElementById('quickAmount').value);

            if (!toLogin || !amount || amount < 1) {
                showNotification('Заполните все поля корректно', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/transfer', {
                    method: 'POST',
                    body: { toLogin, amount }
                });

                showNotification(data.message, 'success', 'Перевод выполнен');
                document.getElementById('quickToLogin').value = '';
                document.getElementById('quickAmount').value = '';
                loadUserData();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка перевода', 'error', 'Ошибка');
            }
        }

        async function makeTransfer() {
            const toLogin = document.getElementById('transferToLogin').value.trim();
            const amount = parseInt(document.getElementById('transferAmount').value);

            if (!toLogin || !amount || amount < 1) {
                showNotification('Заполните все поля корректно', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/transfer', {
                    method: 'POST',
                    body: { toLogin, amount }
                });

                showNotification(data.message, 'success', 'Перевод выполнен');
                document.getElementById('transferToLogin').value = '';
                document.getElementById('transferAmount').value = '';
                loadUserData();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка перевода', 'error', 'Ошибка');
            }
        }

        // ====== КАРТЫ ======
        async function loadCards() {
            try {
                const cards = await apiCall('/api/cards');
                const container = document.getElementById('cardsList');

                if (!cards || cards.length === 0) {
                    container.innerHTML = '<div style="color: #aaa; text-align: center; padding: 40px;"><i class="fas fa-credit-card" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>Карт нет</div>';
                    return;
                }

                let html = '';
                cards.forEach((card, index) => {
                    const cardType = index % 3 === 0 ? 'Platinum' : index % 2 === 0 ? 'Gold' : 'Standard';
                    const cardColor = cardType === 'Platinum' ? '#e5e4e2' : cardType === 'Gold' ? '#ffd700' : '#00aaff';

                    html += `
                        <div style="background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(50, 50, 70, 0.7)); 
                                 border: 1px solid ${cardColor}80; 
                                 border-radius: 15px; 
                                 padding: 20px; 
                                 margin-bottom: 15px; 
                                 position: relative;
                                 overflow: hidden;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div style="font-weight: bold; color: ${cardColor}; font-size: 1.1rem;">
                                    ${cardType} Card
                                </div>
                                <div style="color: #aaa; font-size: 0.9rem;">
                                    #${card.id}
                                </div>
                            </div>
                            <div style="font-family: 'Courier New', monospace; font-size: 1.3rem; color: var(--light); letter-spacing: 2px; margin-bottom: 20px;">
                                ${card.number}
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                                <div>
                                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 5px;">Действует до</div>
                                    <div style="color: var(--light); font-size: 1rem;">${card.expires}</div>
                                </div>
                                <div>
                                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 5px;">CVV</div>
                                    <div style="color: var(--light); font-size: 1rem;">${card.cvv}</div>
                                </div>
                                <div>
                                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 5px;">Создана</div>
                                    <div style="color: var(--light); font-size: 0.9rem;">${formatDate(card.created_at)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('Ошибка загрузки карт:', error);
            }
        }

        async function createCard() {
            try {
                const data = await apiCall('/api/cards/new', { method: 'POST' });
                showNotification(data.message, 'success', 'Карта создана');
                loadCards();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка создания карты', 'error', 'Ошибка');
            }
        }

        // ====== ВКЛАДЫ ======
        async function loadDeposits() {
            try {
                const deposits = await apiCall('/api/deposits');
                const container = document.getElementById('depositsList');

                if (!deposits || deposits.length === 0) {
                    container.innerHTML = '<div style="color: #aaa; text-align: center; padding: 40px;"><i class="fas fa-piggy-bank" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>Вкладов нет</div>';
                    return;
                }

                let html = '';
                deposits.forEach(dep => {
                    const profit = dep.current_amount - dep.amount;
                    const profitPercent = ((profit / dep.amount) * 100).toFixed(2);
                    const hours = Math.floor(dep.minutes_passed / 60);
                    const minutes = dep.minutes_passed % 60;

                    html += `
                        <div style="background: linear-gradient(135deg, rgba(0, 100, 0, 0.2), rgba(0, 50, 100, 0.2)); 
                                 border: 1px solid rgba(0, 255, 136, 0.3); 
                                 border-radius: 15px; 
                                 padding: 20px; 
                                 margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Вклад #${dep.id}</div>
                                    <div style="font-size: 1.5rem; color: var(--primary); font-weight: bold;">
                                        ${formatCurrency(dep.current_amount)}
                                    </div>
                                    <div style="color: #888; font-size: 0.8rem; margin-top: 5px;">
                                        Первоначальный: ${formatCurrency(dep.amount)}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--success); font-weight: bold; font-size: 1.2rem;">
                                        +${profitPercent}%
                                    </div>
                                    <div style="color: #aaa; font-size: 0.8rem; margin-top: 5px;">
                                        за ${hours > 0 ? hours + 'ч ' : ''}${minutes}м
                                    </div>
                                </div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.3); height: 5px; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.min(profitPercent, 100)}%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--success));"></div>
                            </div>
                            <div style="color: #aaa; font-size: 0.8rem; margin-top: 10px; display: flex; justify-content: space-between;">
                                <span>Открыт: ${formatDate(dep.created_at)}</span>
                                <span>Прибыль: +${formatCurrency(profit)}</span>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('Ошибка загрузки вкладов:', error);
            }
        }

        async function createDeposit() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            if (!amount || amount < 1) {
                showNotification('Введите корректную сумму', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/deposits/new', {
                    method: 'POST',
                    body: { amount }
                });

                showNotification(data.message, 'success', 'Вклад создан');
                document.getElementById('depositAmount').value = '';
                loadUserData();
                loadDeposits();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка создания вклада', 'error', 'Ошибка');
            }
        }

        // ====== КРИПТО ======
        async function loadCryptoData() {
            await loadCryptoPrices();
            await loadCryptoPortfolio();
        }

        async function loadCryptoPrices() {
            try {
                const prices = await apiCall('/api/crypto/prices');
                cryptoPrices = prices;

                const container = document.getElementById('cryptoPrices');
                let html = '';

                const coins = [
                    { symbol: 'BTC', name: 'Bitcoin', icon: 'fab fa-bitcoin' },
                    { symbol: 'ETH', name: 'Ethereum', icon: 'fab fa-ethereum' },
                    { symbol: 'DOGE', name: 'Dogecoin', icon: 'fas fa-dog' },
                    { symbol: 'SOL', name: 'Solana', icon: 'fas fa-sun' }
                ];

                coins.forEach(coin => {
                    const price = prices[coin.symbol];
                    const change = (Math.random() - 0.5) * 10;
                    const changeClass = change >= 0 ? 'var(--success)' : 'var(--danger)';
                    const changeIcon = change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                    const priceChange = change >= 0 ? `+${change.toFixed(2)}%` : `${change.toFixed(2)}%`;

                    html += `
                        <div class="function-card" style="cursor: default;">
                            <div class="function-header">
                                <div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="${coin.icon}" style="font-size: 1.5rem; color: ${coin.symbol === 'BTC' ? '#f7931a' : coin.symbol === 'ETH' ? '#627eea' : coin.symbol === 'DOGE' ? '#c2a633' : '#00ffaa'}"></i>
                                        <div>
                                            <div style="font-weight: bold; font-size: 1.2rem; color: var(--light);">${coin.symbol}</div>
                                            <div style="color: #aaa; font-size: 0.9rem;">${coin.name}</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="color: ${changeClass}; font-weight: bold;">
                                    <i class="fas ${changeIcon}"></i> ${priceChange}
                                </div>
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 900; color: var(--primary); margin: 15px 0;">
                                ${formatCurrency(price)}
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem;">
                                <input type="number" class="form-input" 
                                       id="price_${coin.symbol}" 
                                       value="${price.toFixed(2)}"
                                       style="font-size: 0.9rem; padding: 8px 12px; background: rgba(0,0,0,0.5);"
                                       onchange="updateCryptoPriceFields()">
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                updateCryptoPriceFields();

            } catch (error) {
                console.error('Ошибка загрузки курсов:', error);
            }
        }

        async function loadCryptoPortfolio() {
            try {
                const portfolio = await apiCall('/api/crypto/portfolio');
                const container = document.getElementById('cryptoPortfolio');
                const sellSelect = document.getElementById('sellCoin');

                userPortfolio = {};
                sellSelect.innerHTML = '<option value="">Выберите крипту</option>';

                if (!portfolio || portfolio.length === 0) {
                    container.innerHTML = `
                        <div style="color: #aaa; text-align: center; padding: 40px;">
                            <i class="fas fa-coins" style="font-size: 3rem; margin-bottom: 20px; display: block; color: #555;"></i>
                            Портфель пуст<br>
                            <small style="font-size: 0.9rem;">Купите криптовалюту в разделе "Крипта"</small>
                        </div>
                    `;
                    return;
                }

                let portfolioHtml = '';
                let totalValue = 0;
                let totalProfit = 0;

                portfolio.forEach(item => {
                    userPortfolio[item.coin_type] = item;

                    const option = document.createElement('option');
                    option.value = item.coin_type;
                    option.textContent = `${item.coin_type} (${item.amount.toFixed(4)})`;
                    sellSelect.appendChild(option);

                    const currentPrice = cryptoPrices[item.coin_type] || item.buy_price;
                    const itemValue = item.amount * currentPrice;
                    const itemCost = item.amount * item.buy_price;
                    const profit = itemValue - itemCost;
                    const profitPercent = (profit / itemCost) * 100;
                    const profitColor = profit >= 0 ? 'var(--success)' : 'var(--danger)';
                    const profitIcon = profit >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';

                    totalValue += itemValue;
                    totalProfit += profit;

                    portfolioHtml += `
                        <div style="background: rgba(30, 30, 50, 0.5); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 3px solid var(--secondary);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--secondary), #5555ff); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-coins" style="color: white; font-size: 1.2rem;"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: var(--secondary); font-size: 1.1rem;">${item.coin_type}</div>
                                        <div style="color: #aaa; font-size: 0.9rem;">${item.amount.toFixed(4)} монет</div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">${formatCurrency(itemValue)}</div>
                                    <div style="color: ${profitColor}; font-size: 0.85rem;">
                                        <i class="fas ${profitIcon}"></i> ${profit >= 0 ? '+' : ''}${profitPercent.toFixed(2)}%
                                    </div>
                                </div>
                            </div>
                            <div style="color: #888; font-size: 0.8rem; display: flex; justify-content: space-between;">
                                <span>Средняя цена: ${formatCurrency(item.buy_price)}</span>
                                <span>Текущая: ${formatCurrency(currentPrice)}</span>
                            </div>
                        </div>
                    `;
                });

                portfolioHtml = `
                    <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #aaa;">Общая стоимость:</span>
                            <span style="color: var(--primary); font-weight: bold;">${formatCurrency(totalValue)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #aaa;">Общая прибыль:</span>
                            <span style="color: ${totalProfit >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                ${totalProfit >= 0 ? '+' : ''}${formatCurrency(totalProfit)}
                            </span>
                        </div>
                    </div>
                    ${portfolioHtml}
                `;

                container.innerHTML = portfolioHtml;
                updateCryptoPriceFields();

            } catch (error) {
                console.error('Ошибка загрузки портфеля:', error);
            }
        }

        function updateCryptoPriceFields() {
            const buyCoin = document.getElementById('buyCoin').value;
            const buyAmount = parseFloat(document.getElementById('buyAmount').value) || 0;

            if (buyCoin && cryptoPrices[buyCoin]) {
                const price = cryptoPrices[buyCoin];
                document.getElementById('buyPrice').value = price.toFixed(2);
                document.getElementById('buyTotal').textContent = formatCurrency(buyAmount * price);
            }

            const sellCoin = document.getElementById('sellCoin').value;
            const sellAmount = parseFloat(document.getElementById('sellAmount').value) || 0;

            if (sellCoin && cryptoPrices[sellCoin]) {
                const price = cryptoPrices[sellCoin];
                document.getElementById('sellPrice').value = price.toFixed(2);
                document.getElementById('sellTotal').textContent = formatCurrency(sellAmount * price);
            }
        }

        function updateSellForm() {
            const coin = document.getElementById('sellCoin').value;
            const amountInput = document.getElementById('sellAmount');
            const availableInput = document.getElementById('sellAvailable');

            if (coin && userPortfolio[coin]) {
                const available = userPortfolio[coin].amount;
                availableInput.value = available.toFixed(4);
                amountInput.max = available;
                amountInput.placeholder = `Макс: ${available.toFixed(4)}`;
            } else {
                availableInput.value = '0';
                amountInput.max = 0;
                amountInput.placeholder = '0.001';
            }

            updateCryptoPriceFields();
        }

        async function buyCrypto() {
            const coin = document.getElementById('buyCoin').value;
            const amount = parseFloat(document.getElementById('buyAmount').value);
            const price = parseFloat(document.getElementById('buyPrice').value);

            if (!coin || !amount || amount <= 0 || !price) {
                showNotification('Заполните все поля корректно', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/crypto/buy', {
                    method: 'POST',
                    body: { coin, amount, price }
                });

                showNotification(data.message, 'success', 'Покупка крипты');
                document.getElementById('buyAmount').value = '';
                loadUserData();
                loadCryptoPortfolio();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка покупки', 'error', 'Ошибка');
            }
        }

        async function sellCrypto() {
            const coin = document.getElementById('sellCoin').value;
            const amount = parseFloat(document.getElementById('sellAmount').value);
            const price = parseFloat(document.getElementById('sellPrice').value);

            if (!coin || !amount || amount <= 0 || !price) {
                showNotification('Заполните все поля корректно', 'error', 'Ошибка');
                return;
            }

            if (userPortfolio[coin] && amount > userPortfolio[coin].amount) {
                showNotification('Недостаточно криптовалюты для продажи', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/crypto/sell', {
                    method: 'POST',
                    body: { coin, amount, price }
                });

                showNotification(data.message + (data.profit >= 0 ? ` Прибыль: +${data.profit}₽` : ` Убыток: ${data.profit}₽`),
                    data.profit >= 0 ? 'success' : 'warning',
                    'Продажа крипты');
                document.getElementById('sellAmount').value = '';
                loadUserData();
                loadCryptoPortfolio();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка продажи', 'error', 'Ошибка');
            }
        }

        // ====== КРЕДИТЫ ======
        async function loadCredits() {
            try {
                const credits = await apiCall('/api/credits');
                const container = document.getElementById('creditsList');
                const select = document.getElementById('payCreditSelect');

                select.innerHTML = '<option value="">Выберите кредит</option>';

                if (!credits || credits.length === 0) {
                    container.innerHTML = `
                        <div style="color: #aaa; text-align: center; padding: 40px;">
                            <i class="fas fa-hand-holding-usd" style="font-size: 3rem; margin-bottom: 20px; display: block; color: #555;"></i>
                            Активных кредитов нет
                        </div>
                    `;
                    document.getElementById('creditInfo').innerHTML = `
                        <div style="background: rgba(255, 85, 85, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 85, 85, 0.3); text-align: center;">
                            <div style="color: var(--danger); font-size: 1.2rem; margin-bottom: 10px;">
                                <i class="fas fa-exclamation-circle"></i> Кредит не выбран
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem;">
                                Выберите кредит для погашения
                            </div>
                        </div>
                    `;
                    return;
                }

                let creditsHtml = '';
                credits.forEach(credit => {
                    const paidPercent = ((credit.amount - (credit.remaining - credit.amount)) / credit.amount * 100).toFixed(0);
                    const daysLeft = Math.ceil((new Date(credit.next_payment) - new Date()) / (1000 * 60 * 60 * 24));

                    creditsHtml += `
                        <div style="background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 170, 0, 0.1)); 
                                 border: 1px solid rgba(255, 85, 85, 0.3); 
                                 border-radius: 12px; 
                                 padding: 20px; 
                                 margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Кредит #${credit.id}</div>
                                    <div style="font-size: 1.5rem; color: var(--danger); font-weight: bold;">
                                        ${formatCurrency(credit.remaining)} / ${formatCurrency(credit.amount)}
                                    </div>
                                    <div style="color: #888; font-size: 0.8rem; margin-top: 5px;">
                                        Получен: ${formatDate(credit.created_at)}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--warning); font-weight: bold; font-size: 1.2rem;">
                                        ${(credit.interest_rate * 100)}%
                                    </div>
                                    <div style="color: #aaa; font-size: 0.8rem; margin-top: 5px;">
                                        ${daysLeft > 0 ? `${daysLeft} дн.` : 'Просрочен!'}
                                    </div>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); height: 5px; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${paidPercent}%; height: 100%; background: linear-gradient(90deg, var(--warning), var(--danger));"></div>
                            </div>
                            <div style="color: #aaa; font-size: 0.8rem; margin-top: 10px; display: flex; justify-content: space-between;">
                                <span>Осталось: ${formatCurrency(credit.remaining)}</span>
                                <span>Оплатить до: ${new Date(credit.next_payment).toLocaleDateString('ru-RU')}</span>
                            </div>
                        </div>
                    `;

                    const option = document.createElement('option');
                    option.value = credit.id;
                    option.textContent = `Кредит #${credit.id} - Остаток: ${formatCurrency(credit.remaining)}`;
                    select.appendChild(option);
                });

                container.innerHTML = creditsHtml;
                updateCreditInfo();

            } catch (error) {
                console.error('Ошибка загрузки кредитов:', error);
            }
        }

        function updateCreditInfo() {
            const creditId = document.getElementById('payCreditSelect').value;
            const creditInfo = document.getElementById('creditInfo');

            if (!creditId) {
                creditInfo.innerHTML = `
                    <div style="background: rgba(255, 85, 85, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 85, 85, 0.3); text-align: center;">
                        <div style="color: var(--danger); font-size: 1.2rem; margin-bottom: 10px;">
                            <i class="fas fa-exclamation-circle"></i> Кредит не выбран
                        </div>
                        <div style="color: #aaa; font-size: 0.9rem;">
                            Выберите кредит для погашения
                        </div>
                    </div>
                `;
                return;
            }
        }

        function updateCreditTotal() {
            const amount = parseInt(document.getElementById('creditAmount').value) || 0;
            const receive = amount;
            const total = Math.floor(amount * 1.1);

            document.getElementById('creditReceive').textContent = formatCurrency(receive);
            document.getElementById('creditTotal').textContent = formatCurrency(total);
        }

        async function takeCredit() {
            const amount = parseInt(document.getElementById('creditAmount').value);
            if (!amount || amount < 1 || amount > 100000) {
                showNotification('Введите корректную сумму (1-100,000₽)', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/credits/new', {
                    method: 'POST',
                    body: { amount }
                });

                showNotification(data.message, 'success', 'Кредит получен');
                document.getElementById('creditAmount').value = '';
                document.getElementById('creditTotal').textContent = '0 ₽';
                loadUserData();
                loadCredits();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка получения кредита', 'error', 'Ошибка');
            }
        }

        async function payCredit() {
            const creditId = document.getElementById('payCreditSelect').value;

            if (!creditId) {
                showNotification('Выберите кредит для погашения', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/credits/pay', {
                    method: 'POST',
                    body: { creditId }
                });

                showNotification(data.message, 'success', 'Кредит погашен');
                loadUserData();
                loadCredits();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка погашения', 'error', 'Ошибка');
            }
        }

        // ====== ЛОТЕРЕЯ ======
        async function buyLotteryTickets() {
            const tickets = parseInt(document.getElementById('lotteryTickets').value) || 1;

            if (tickets < 1 || tickets > 10) {
                showNotification('Можно купить от 1 до 10 билетов', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/lottery/buy', {
                    method: 'POST',
                    body: { tickets }
                });

                showNotification(data.message, 'success', 'Лотерея');
                loadUserData();

            } catch (error) {
                showNotification(error.message || 'Ошибка покупки', 'error', 'Ошибка');
            }
        }

        async function playLottery() {
            try {
                const data = await apiCall('/api/lottery/play', {
                    method: 'POST'
                });

                if (data.won > 0) {
                    showNotification(data.message, 'success', 'ПОБЕДА!');
                } else {
                    showNotification(data.message, 'warning', 'Лотерея');
                }

                loadUserData();
                loadHistory();

            } catch (error) {
                showNotification(error.message || 'Ошибка лотереи', 'error', 'Ошибка');
            }
        }

        // ====== ЛИДЕРБОРД ======
        async function loadLeaderboard(type) {
            leaderboardType = type;

            document.querySelectorAll('#leaderboardSection .btn').forEach(btn => {
                btn.style.background = 'linear-gradient(135deg, var(--primary), var(--secondary))';
            });
            document.getElementById(`lb${type.charAt(0).toUpperCase() + type.slice(1)}`).style.background = 'linear-gradient(135deg, var(--accent), #ff5500)';

            try {
                const leaders = await apiCall(`/api/leaderboard/${type}`);
                const table = document.getElementById('leaderboardTable');

                if (!leaders || leaders.length === 0) {
                    table.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #aaa;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                Лидерборд пуст
                            </td>
                        </tr>
                    `;
                    return;
                }

                let html = '';
                leaders.forEach((leader, index) => {
                    const isMe = leader.login === userData?.login;
                    const rowClass = isMe ? 'style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 136, 255, 0.1)); border-left: 3px solid var(--primary);"' : '';
                    const nameDisplay = isMe ? `<strong style="color: var(--primary);">${leader.name} (Вы)</strong>` : leader.name;

                    html += `
                        <tr ${rowClass}>
                            <td style="font-weight: bold; font-size: 1.2rem;">
                                ${leader.medal || `#${leader.position}`}
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, ${isMe ? 'var(--primary)' : '#555'}, ${isMe ? 'var(--secondary)' : '#777'}); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-user" style="color: white;"></i>
                                    </div>
                                    <div>
                                        <div>${nameDisplay}</div>
                                        <div style="color: #aaa; font-size: 0.8rem;">@${leader.login}</div>
                                    </div>
                                </div>
                            </td>
                            <td style="color: var(--primary); font-weight: bold;">${formatCurrency(leader.balance)}</td>
                            <td style="color: var(--warning); font-weight: bold;">${leader.level}</td>
                            <td style="color: var(--light);">${leader.clicks}</td>
                            <td style="color: var(--success); font-weight: bold;">${formatCurrency(leader.total_earned || 0)}</td>
                            <td>
                                <span style="padding: 5px 10px; background: rgba(0, 255, 136, 0.1); border-radius: 5px; color: var(--primary); font-size: 0.8rem;">
                                    ${leader.mining_farm || 0} ферм
                                </span>
                            </td>
                        </tr>
                    `;
                });

                table.innerHTML = html;
                updateMyPosition(leaders);

            } catch (error) {
                console.error('Ошибка загрузки лидерборда:', error);
            }
        }

        function updateMyPosition(leaders) {
            const myPositionDiv = document.getElementById('myPosition');
            const myPosition = leaders.findIndex(l => l.login === userData?.login) + 1;

            if (myPosition > 0) {
                const leader = leaders[myPosition - 1];
                myPositionDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">
                                ${myPosition}
                            </div>
                            <div>
                                <div style="font-size: 1.2rem; color: var(--light);">${leader.name}</div>
                                <div style="color: #aaa; font-size: 0.9rem;">@${leader.login}</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--primary); font-size: 1.5rem; font-weight: bold;">${formatCurrency(leader.balance)}</div>
                            <div style="color: #aaa; font-size: 0.9rem;">${leader.clicks} кликов • Ур. ${leader.level}</div>
                        </div>
                    </div>
                `;
            } else {
                myPositionDiv.innerHTML = `
                    <div style="text-align: center; color: #aaa;">
                        <i class="fas fa-user" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                        Вы не в топ-10 по этой категории
                    </div>
                `;
            }
        }

        // ====== ИСТОРИЯ ======
        function filterHistory(type) {
            historyFilter = type;
            historyLastId = null;

            document.querySelectorAll('#historySection .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            loadHistory();
        }

        async function loadHistory(beforeId = null) {
            try {
                const url = beforeId ? `/api/history?before_id=${beforeId}` : '/api/history';
                const data = await apiCall(url);

                const operations = data.operations || [];
                historyHasMore = data.hasMore || false;
                historyLastId = data.lastId || null;

                const table = document.getElementById('historyTable');

                if (!beforeId) {
                    table.innerHTML = '';
                }

                if (operations.length === 0 && !beforeId) {
                    table.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #aaa;">
                                <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                История операций пуста
                            </td>
                        </tr>
                    `;
                    document.getElementById('loadMoreBtn').style.display = 'none';
                    return;
                }

                let filteredOperations = operations;
                if (historyFilter !== 'all') {
                    filteredOperations = operations.filter(op => {
                        if (historyFilter === 'transfer') return op.type === 'transfer';
                        if (historyFilter === 'click') return op.type.includes('click');
                        if (historyFilter === 'crypto') return op.type.includes('crypto');
                        if (historyFilter === 'deposit') return op.type.includes('deposit');
                        return true;
                    });
                }

                filteredOperations.forEach(record => {
                    const row = document.createElement('tr');
                    let amountText = '';
                    let typeIcon = '';
                    let typeColor = '';
                    let typeText = '';
                    let statusIcon = '';

                    switch (record.type) {
                        case 'transfer':
                            typeIcon = 'fa-exchange-alt';
                            typeColor = 'var(--secondary)';
                            typeText = 'Перевод';
                            amountText = record.amount ? `${record.amount > 0 ? '+' : ''}${formatCurrency(record.amount)}` : '';
                            statusIcon = record.amount > 0 ? 'fa-arrow-down text-success' : 'fa-arrow-up text-danger';
                            break;
                        case 'click':
                            typeIcon = 'fa-mouse-pointer';
                            typeColor = 'var(--success)';
                            typeText = 'Клик';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-bolt text-success';
                            break;
                        case 'deposit_open':
                            typeIcon = 'fa-piggy-bank';
                            typeColor = 'var(--primary)';
                            typeText = 'Вклад';
                            amountText = record.amount ? `-${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-lock text-primary';
                            break;
                        case 'deposit_accrual':
                            typeIcon = 'fa-chart-line';
                            typeColor = 'var(--success)';
                            typeText = 'Проценты';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-arrow-up text-success';
                            break;
                        case 'crypto_buy':
                            typeIcon = 'fa-shopping-cart';
                            typeColor = 'var(--secondary)';
                            typeText = 'Купля крипты';
                            amountText = record.amount ? `-${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-arrow-down text-warning';
                            break;
                        case 'crypto_sell':
                            typeIcon = 'fa-cash-register';
                            typeColor = 'var(--accent)';
                            typeText = 'Продажа крипты';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-arrow-up text-success';
                            break;
                        case 'credit_taken':
                            typeIcon = 'fa-hand-holding-usd';
                            typeColor = 'var(--warning)';
                            typeText = 'Кредит получен';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-plus-circle text-warning';
                            break;
                        case 'credit_paid':
                            typeIcon = 'fa-money-check-alt';
                            typeColor = 'var(--danger)';
                            typeText = 'Кредит погашен';
                            amountText = record.amount ? `-${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-check-circle text-danger';
                            break;
                        case 'lottery':
                            typeIcon = 'fa-dice';
                            typeColor = '#ff0088';
                            typeText = 'Лотерея';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = record.amount > 0 ? 'fa-gift text-success' : 'fa-times text-danger';
                            break;
                        case 'daily_bonus':
                            typeIcon = 'fa-gift';
                            typeColor = '#00ff88';
                            typeText = 'Ежедневный бонус';
                            amountText = record.amount ? `+${formatCurrency(record.amount)}` : '';
                            statusIcon = 'fa-gift text-success';
                            break;
                        default:
                            typeIcon = 'fa-question-circle';
                            typeColor = '#aaa';
                            typeText = record.type;
                            statusIcon = 'fa-info-circle';
                    }

                    const amountColor = record.amount > 0 ? 'var(--success)' : record.amount < 0 ? 'var(--danger)' : '#aaa';

                    row.innerHTML = `
                        <td>${formatDateTime(record.timestamp)}</td>
                        <td style="color: ${typeColor};">
                            <i class="fas ${typeIcon}"></i> ${typeText}
                        </td>
                        <td style="font-weight: bold; color: ${amountColor}">
                            ${amountText}
                        </td>
                        <td style="color: #aaa;">${record.details || ''}</td>
                        <td>
                            <i class="fas ${statusIcon}" style="font-size: 1.2rem;"></i>
                        </td>
                    `;
                    table.appendChild(row);
                });

                document.getElementById('loadMoreBtn').style.display = historyHasMore ? 'block' : 'none';

            } catch (error) {
                console.error('Ошибка загрузки истории:', error);
            }
        }

        function loadMoreHistory() {
            if (historyLastId) {
                loadHistory(historyLastId);
            }
        }

        // ====== АДМИН-ПАНЕЛЬ ======
        async function loadAllUsersWithPasswords() {
            try {
                const data = await apiCall('/api/admin/users-full');
                const container = document.getElementById('fullUsersList');

                if (!data.users || data.users.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #aaa;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                Нет пользователей
                            </td>
                        </tr>
                    `;
                    return;
                }

                let html = '';
                data.users.forEach(user => {
                    const isILIA = user.login === 'ILIA';
                    const rowClass = isILIA ? 'style="background: linear-gradient(135deg, rgba(255, 0, 136, 0.1), rgba(136, 0, 255, 0.1));"' : '';

                    html += `
                        <tr ${rowClass}>
                            <td>${user.id}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <strong>${user.login}</strong>
                                    ${isILIA ? '<span style="color: var(--accent);">👑</span>' : ''}
                                </div>
                            </td>
                            <td style="font-family: monospace; color: #aaa; font-size: 0.85rem; word-break: break-all;">
                                ${user.password.substring(0, 20)}...
                            </td>
                            <td>${user.name}</td>
                            <td style="color: var(--primary); font-weight: bold;">${formatCurrency(user.balance)}</td>
                            <td style="color: var(--warning); font-weight: bold;">${user.level}</td>
                            <td style="color: #aaa; font-size: 0.9rem;">${formatDate(user.created_at)}</td>
                        </tr>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('Ошибка загрузки пользователей с паролями:', error);
                showNotification(error.message || 'Ошибка загрузки', 'error', 'Ошибка');
            }
        }

        function searchFullUsers() {
            const search = document.getElementById('fullUserSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#fullUsersList tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        async function loadDeletedUsers() {
            try {
                const data = await apiCall('/api/admin/deleted-users');
                const container = document.getElementById('deletedUsersList');

                if (!data.users || data.users.length === 0) {
                    container.innerHTML = '<div style="color: #aaa; text-align: center; padding: 40px;">Нет удаленных пользователей</div>';
                    return;
                }

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Логин</th>
                                <th>Имя</th>
                                <th>Баланс</th>
                                <th>Уровень</th>
                                <th>Дата удаления</th>
                                <th>Удалил</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                data.users.forEach(user => {
                    html += `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.login}</td>
                            <td>${user.name}</td>
                            <td style="color: var(--primary);">${formatCurrency(user.balance)}</td>
                            <td>${user.level}</td>
                            <td style="color: #aaa; font-size: 0.9rem;">${formatDate(user.deleted_at)}</td>
                            <td>${user.deleted_by || 'Система'}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;

            } catch (error) {
                showNotification(error.message || 'Ошибка загрузки удаленных пользователей', 'error', 'Ошибка');
            }
        }

        async function loadAdminStats() {
            try {
                const data = await apiCall('/api/admin/stats');
                const container = document.getElementById('adminStats');

                let html = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; border-left: 3px solid var(--primary);">
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Пользователей</div>
                            <div style="color: var(--primary); font-size: 1.5rem; font-weight: bold;">${data.stats.general?.total_users || 0}</div>
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; border-left: 3px solid var(--success);">
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Общий баланс</div>
                            <div style="color: var(--success); font-size: 1.5rem; font-weight: bold;">${formatCurrency(data.stats.general?.total_balance || 0)}</div>
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; border-left: 3px solid var(--warning);">
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Средний баланс</div>
                            <div style="color: var(--warning); font-size: 1.5rem; font-weight: bold;">${formatCurrency(data.stats.general?.avg_balance || 0)}</div>
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; border-left: 3px solid var(--accent);">
                            <div style="color: #aaa; font-size: 0.9rem; margin-bottom: 5px;">Активных (24ч)</div>
                            <div style="color: var(--accent); font-size: 1.5rem; font-weight: bold;">${data.stats.active_users?.active_24h || 0}</div>
                        </div>
                    </div>
                `;

                if (data.stats.crypto_top && data.stats.crypto_top.length > 0) {
                    html += `
                        <h4 style="color: var(--primary); margin: 20px 0 10px 0;">Топ крипто-инвесторы</h4>
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px;">
                            ${data.stats.crypto_top.map((user, index) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: ${index < data.stats.crypto_top.length - 1 ? '10px' : '0'}; padding-bottom: ${index < data.stats.crypto_top.length - 1 ? '10px' : '0'}; ${index < data.stats.crypto_top.length - 1 ? 'border-bottom: 1px solid rgba(255,255,255,0.1)' : ''}">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #${index === 0 ? 'ffd700' : index === 1 ? 'c0c0c0' : 'cd7f32'}, #${index === 0 ? 'ffaa00' : index === 1 ? '999' : 'b87333'}); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-${index === 0 ? 'crown' : 'medal'}" style="color: white; font-size: 0.8rem;"></i>
                                        </div>
                                        <div>
                                            <div style="font-weight: bold; color: var(--light);">${user.name}</div>
                                            <div style="color: #aaa; font-size: 0.8rem;">@${user.login}</div>
                                        </div>
                                    </div>
                                    <div style="color: var(--primary); font-weight: bold;">${formatCurrency(user.crypto_value || 0)}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                container.innerHTML = html;

            } catch (error) {
                showNotification(error.message || 'Ошибка загрузки статистики', 'error', 'Ошибка');
            }
        }

        async function adminUpdateBalance() {
            const login = document.getElementById('adminUserLogin').value.trim();
            const amount = document.getElementById('adminAmount').value;
            const operation = document.getElementById('adminOperation').value;

            if (!login || !amount || !operation) {
                showNotification('Заполните все поля', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/admin/balance', {
                    method: 'POST',
                    body: { login, amount, operation }
                });

                showNotification(`Баланс пользователя ${login} изменен: ${operation} ${amount}₽`, 'success', 'Баланс обновлен');

                document.getElementById('adminUserLogin').value = '';
                document.getElementById('adminAmount').value = '';

                searchUsers();
                loadAllUsersWithPasswords();

            } catch (error) {
                showNotification(error.message || 'Ошибка изменения баланса', 'error', 'Ошибка');
            }
        }

        async function deleteUser() {
            const userId = document.getElementById('deleteUserId').value;
            const confirmText = document.getElementById('deleteConfirm').value;

            if (!userId || userId < 2) {
                showNotification('Введите корректный ID пользователя (минимум 2)', 'error', 'Ошибка');
                return;
            }

            if (confirmText !== 'УДАЛИТЬ') {
                showNotification('Для подтверждения введите "УДАЛИТЬ"', 'error', 'Ошибка');
                return;
            }

            if (!confirm(`Вы уверены, что хотите удалить пользователя #${userId}? Это действие невозможно отменить!`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Ошибка удаления');
                }

                showNotification(data.message, 'success', 'Пользователь удален');

                // Очищаем поля
                document.getElementById('deleteUserId').value = '';
                document.getElementById('deleteConfirm').value = '';

                // Обновляем списки пользователей
                searchUsers();
                loadDeletedUsers();
                loadAllUsersWithPasswords();

            } catch (error) {
                showNotification(error.message, 'error', 'Ошибка удаления');
            }
        }

        async function adminMassGive() {
            const amount = document.getElementById('massAmount').value;
            const message = document.getElementById('massMessage').value;

            if (!amount) {
                showNotification('Укажите сумму', 'error', 'Ошибка');
                return;
            }

            try {
                const data = await apiCall('/api/admin/mass-give', {
                    method: 'POST',
                    body: { amount, message }
                });

                showNotification(data.message, 'success', 'Массовое начисление');

                document.getElementById('massAmount').value = '';
                document.getElementById('massMessage').value = '';

            } catch (error) {
                showNotification(error.message || 'Ошибка массового начисления', 'error', 'Ошибка');
            }
        }

        async function adminResetLeaderboard(type) {
            if (!confirm(`Вы уверены, что хотите сбросить лидерборд "${type}"?`)) {
                return;
            }

            try {
                const data = await apiCall('/api/admin/reset-leaderboard', {
                    method: 'POST',
                    body: { type }
                });

                showNotification(data.message, 'success', 'Лидерборд сброшен');

                if (document.querySelector('#leaderboardSection.active')) {
                    loadLeaderboard(leaderboardType);
                }

            } catch (error) {
                showNotification(error.message || 'Ошибка сброса лидерборда', 'error', 'Ошибка');
            }
        }

        async function loadAdminLogs() {
            try {
                const data = await apiCall('/api/admin/logs');
                const container = document.getElementById('adminLogs');

                if (!data.logs || data.logs.length === 0) {
                    container.innerHTML = '<div style="color: #aaa; text-align: center; padding: 40px;">Логи пусты</div>';
                    return;
                }

                let html = '';
                data.logs.forEach(log => {
                    const date = new Date(log.timestamp);
                    const formattedDate = `${date.toLocaleDateString('ru-RU')} ${date.toLocaleTimeString('ru-RU')}`;

                    html += `
                        <div style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <div style="font-weight: bold; color: var(--light);">${log.action}</div>
                                <div style="color: #aaa; font-size: 0.8rem;">${formattedDate}</div>
                            </div>
                            <div style="color: #aaa; font-size: 0.9rem;">
                                Админ: <span style="color: var(--primary);">${log.admin_login}</span>
                                ${log.target_user ? ` → Пользователь: <span style="color: var(--secondary);">${log.target_user}</span>` : ''}
                            </div>
                            ${log.details ? `<div style="color: #888; font-size: 0.8rem; margin-top: 5px;">${log.details}</div>` : ''}
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                showNotification(error.message || 'Ошибка загрузки логов', 'error', 'Ошибка');
            }
        }

        async function searchUsers() {
            const search = document.getElementById('userSearch').value;
            const minBalance = document.getElementById('minBalance').value;
            const maxBalance = document.getElementById('maxBalance').value;

            let url = '/api/admin/users?limit=20';
            if (search) url += `&search=${encodeURIComponent(search)}`;
            if (minBalance) url += `&min_balance=${minBalance}`;
            if (maxBalance) url += `&max_balance=${maxBalance}`;

            try {
                const data = await apiCall(url);
                const container = document.getElementById('usersList');

                if (!data.users || data.users.length === 0) {
                    container.innerHTML = '<div style="color: #aaa; text-align: center; padding: 40px;">Пользователи не найдены</div>';
                    return;
                }

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Логин</th>
                                <th>Имя</th>
                                <th>Баланс</th>
                                <th>Уровень</th>
                                <th>Клики</th>
                                <th>Фермы</th>
                                <th>Дата регистрации</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                data.users.forEach(user => {
                    const isILIA = user.login === 'ILIA';
                    const rowClass = isILIA ? 'style="background: linear-gradient(135deg, rgba(255, 0, 136, 0.1), rgba(136, 0, 255, 0.1));"' : '';

                    html += `
                        <tr ${rowClass}>
                            <td>${user.id}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    ${user.login}
                                    ${isILIA ? '<span style="color: var(--accent); font-size: 0.8rem;">👑</span>' : ''}
                                </div>
                            </td>
                            <td>${user.name}</td>
                            <td style="color: var(--primary); font-weight: bold;">${formatCurrency(user.balance)}</td>
                            <td style="color: var(--warning); font-weight: bold;">${user.level}</td>
                            <td>${user.clicks}</td>
                            <td>${user.mining_farm || 0}</td>
                            <td style="color: #aaa; font-size: 0.9rem;">${formatDate(user.created_at)}</td>
                            <td>
                                ${!isILIA ? `<button class="btn btn-sm btn-danger" onclick="prepareDeleteUser(${user.id}, '${user.login}')">
                                    <i class="fas fa-trash"></i>
                                </button>` : '<span style="color: #aaa;">Нельзя удалить</span>'}
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    <div style="color: #aaa; font-size: 0.9rem; margin-top: 15px; text-align: center;">
                        Найдено: ${data.pagination?.total || 0} пользователей
                    </div>
                `;

                container.innerHTML = html;

            } catch (error) {
                showNotification(error.message || 'Ошибка поиска пользователей', 'error', 'Ошибка');
            }
        }

        function prepareDeleteUser(userId, login) {
            document.getElementById('deleteUserId').value = userId;
            document.getElementById('deleteConfirm').value = '';
            showNotification(`Подготовлено удаление пользователя ${login} (ID: ${userId})`, 'warning', 'Подготовка удаления');
        }

        // ====== АВТООБНОВЛЕНИЕ ======
        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);

            autoRefreshInterval = setInterval(() => {
                loadUserData();
                loadDeposits();
                loadCryptoData();
                loadCryptoPrices();
                updateDailyBonus();

                if (document.querySelector('#leaderboardSection.active')) {
                    loadLeaderboard(leaderboardType);
                }
            }, 10000);
        }

        // ====== ВЫХОД ======
        function logout() {
            token = null;
            userData = null;
            localStorage.removeItem('ebank_token');

            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }

            if (autoClickerInterval) {
                clearInterval(autoClickerInterval);
                autoClickerInterval = null;
            }

            if (cryptoPriceUpdateInterval) {
                clearInterval(cryptoPriceUpdateInterval);
                cryptoPriceUpdateInterval = null;
            }

            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('authApp').style.display = 'flex';
            document.getElementById('adminTab').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            showAuthTab('login');

            document.querySelector('.logo').innerHTML = 'E-BANK';

            showNotification('Вы вышли из системы', 'info', 'Выход');
        }

        // ====== ИНИЦИАЛИЗАЦИЯ ======
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 E-BANK 2.0 ULTRA загружен!');

            // Слушатели событий
            document.getElementById('buyCoin').addEventListener('change', updateCryptoPriceFields);
            document.getElementById('sellCoin').addEventListener('change', updateSellForm);
            document.getElementById('buyAmount').addEventListener('input', updateCryptoPriceFields);
            document.getElementById('sellAmount').addEventListener('input', updateCryptoPriceFields);
            document.getElementById('payCreditSelect').addEventListener('change', updateCreditInfo);
            document.getElementById('creditAmount').addEventListener('input', updateCreditTotal);
            document.getElementById('fullUserSearch').addEventListener('input', searchFullUsers);

            // Если есть токен, загружаем данные
            if (token) {
                apiCall('/api/me')
                    .then(data => {
                        userData = data;
                        showMainApp();

                        if (data.login === 'ILIA') {
                            document.getElementById('adminTab').style.display = 'flex';
                            setTimeout(() => {
                                showNotification('🔥 ВЛАСТЕЛИН ИЛЬЯ! ВАШЕ ВЕЛИЧИЕ ВОЗВРАЩАЕТСЯ! 🔥', 'special', 'СЕКРЕТНЫЙ ДОСТУП');
                            }, 1000);
                        }
                    })
                    .catch(() => {
                        localStorage.removeItem('ebank_token');
                        token = null;
                    });
            }

            // Запускаем анимацию фона
            startBackgroundAnimation();
        });

        function startBackgroundAnimation() {
            const circles = document.createElement('div');
            circles.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: -1;
                overflow: hidden;
            `;

            for (let i = 0; i < 5; i++) {
                const circle = document.createElement('div');
                const size = 100 + Math.random() * 200;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = 20 + Math.random() * 20;
                const delay = Math.random() * 10;

                circle.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    border-radius: 50%;
                    background: radial-gradient(circle, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
                    left: ${x}%;
                    top: ${y}%;
                    animation: floatCircle ${duration}s ease-in-out ${delay}s infinite alternate;
                `;

                circles.appendChild(circle);
            }

            document.body.appendChild(circles);

            const circleStyle = document.createElement('style');
            circleStyle.textContent = `
                @keyframes floatCircle {
                    0% {
                        transform: translate(0, 0) scale(1);
                        opacity: 0.3;
                    }
                    25% {
                        transform: translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px) scale(1.1);
                        opacity: 0.5;
                    }
                    50% {
                        transform: translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px) scale(0.9);
                        opacity: 0.3;
                    }
                    75% {
                        transform: translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px) scale(1.2);
                        opacity: 0.5;
                    }
                    100% {
                        transform: translate(0, 0) scale(1);
                        opacity: 0.3;
                    }
                }
            `;
            document.head.appendChild(circleStyle);
        }

        // Экспортируем функции для глобального доступа
        window.showSection = showSection;
        window.showAuthTab = showAuthTab;
        window.showAdminTab = showAdminTab;
        window.login = login;
        window.register = register;
        window.logout = logout;
        window.clickHandler = clickHandler;
        window.buyUpgrade = buyUpgrade;
        window.quickTransfer = quickTransfer;
        window.makeTransfer = makeTransfer;
        window.createCard = createCard;
        window.createDeposit = createDeposit;
        window.buyCrypto = buyCrypto;
        window.sellCrypto = sellCrypto;
        window.updateCryptoPriceFields = updateCryptoPriceFields;
        window.updateSellForm = updateSellForm;
        window.takeCredit = takeCredit;
        window.payCredit = payCredit;
        window.updateCreditTotal = updateCreditTotal;
        window.updateCreditInfo = updateCreditInfo;
        window.claimDailyBonus = claimDailyBonus;
        window.buyLotteryTickets = buyLotteryTickets;
        window.playLottery = playLottery;
        window.loadLeaderboard = loadLeaderboard;
        window.filterHistory = filterHistory;
        window.loadMoreHistory = loadMoreHistory;
        window.loadAdminStats = loadAdminStats;
        window.adminUpdateBalance = adminUpdateBalance;
        window.deleteUser = deleteUser;
        window.prepareDeleteUser = prepareDeleteUser;
        window.adminMassGive = adminMassGive;
        window.adminResetLeaderboard = adminResetLeaderboard;
        window.loadAdminLogs = loadAdminLogs;
        window.loadDeletedUsers = loadDeletedUsers;
        window.searchUsers = searchUsers;
        window.loadAllUsersWithPasswords = loadAllUsersWithPasswords;
        window.searchFullUsers = searchFullUsers;
        window.closeNotification = closeNotification;
    </script>
</body>

</html>